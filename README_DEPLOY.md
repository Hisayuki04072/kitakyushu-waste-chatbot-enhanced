# åŒ—ä¹å·å¸‚ã”ã¿åˆ†åˆ¥ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆ

é«˜æ©Ÿèƒ½ãªRAGï¼ˆRetrieval-Augmented Generationï¼‰ãƒ™ãƒ¼ã‚¹ã®ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚

## ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹æ³•

### å‰ææ¡ä»¶

- Docker & Docker Compose ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨
- GPUä½¿ç”¨ã®å ´åˆ: NVIDIA Container Toolkit ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨
- 8GBä»¥ä¸Šã®RAMæ¨å¥¨

### 1. ã‚¯ã‚¤ãƒƒã‚¯ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³
git clone https://github.com/Hisayuki04072/kitakyushu-waste-chatbot-enhanced.git
cd kitakyushu-waste-chatbot-enhanced

# ãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿè¡Œ
./deploy.sh
```

### 2. æ‰‹å‹•ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# 1. SSLè¨¼æ˜æ›¸ç”Ÿæˆ
./generate_ssl.sh

# 2. ç’°å¢ƒå¤‰æ•°è¨­å®š
cp .env.example .env
# å¿…è¦ã«å¿œã˜ã¦ .env ã‚’ç·¨é›†

# 3. ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•
docker-compose -f docker-compose.prod.yml up -d

# 4. ãƒ­ã‚°ç¢ºèª
docker-compose -f docker-compose.prod.yml logs -f
```

### 3. ã‚¢ã‚¯ã‚»ã‚¹æ–¹æ³•

- **ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒª**: https://localhost (æ¨å¥¨)
- **HTTP**: http://localhost (HTTPSã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ)
- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ç›´æ¥**: http://localhost:8501
- **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰API**: http://localhost:8000

## ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Nginx        â”‚    â”‚   Streamlit     â”‚    â”‚   FastAPI       â”‚
â”‚  (Reverse       â”‚â”€â”€â”€â”€â”‚   Frontend      â”‚â”€â”€â”€â”€â”‚   Backend       â”‚
â”‚   Proxy)        â”‚    â”‚   :8501         â”‚    â”‚   :8000         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                              â”‚
         â”‚                                              â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HTTPS/HTTP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    Ollama       â”‚
                    â”‚   LLM Server    â”‚
                    â”‚   :11434        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ› ï¸ ä¸»è¦æ©Ÿèƒ½

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æ©Ÿèƒ½
- ğŸ“± ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãªWebUI
- ğŸš€ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å¿œç­”
- ğŸ“„ CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ»ç®¡ç†
- ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ ç›£è¦–ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
- ğŸŒ å¤šè¨€èªå¯¾å¿œï¼ˆæ—¥æœ¬èªãƒ»è‹±èªï¼‰

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æ©Ÿèƒ½
- ğŸ¤– Llama-3.1-Swallow-8B ã«ã‚ˆã‚‹æ—¥æœ¬èªç‰¹åŒ–LLM
- ğŸ” BGE-M3 + BM25 ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢
- ğŸ“š ChromaDB ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
- ğŸ”„ ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ»ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°ä¸¡å¯¾å¿œAPI
- ğŸ“ˆ GPUä½¿ç”¨ç‡ç›£è¦–

## ğŸ”§ è¨­å®š

### ç’°å¢ƒå¤‰æ•°

| å¤‰æ•°å | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ | èª¬æ˜ |
|--------|-------------|------|
| `LLM_MODEL` | `hf.co/mmnga/Llama-3.1-Swallow-8B-Instruct-v0.5-gguf:Q4_K_M` | ä½¿ç”¨ã™ã‚‹LLMãƒ¢ãƒ‡ãƒ« |
| `OLLAMA_HOST` | `http://ollama:11434` | Ollamaã‚µãƒ¼ãƒãƒ¼ã®URL |
| `BACKEND_URL` | `http://backend:8000` | ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰API URL |
| `CHROMA_TELEMETRY` | `False` | ChromaDBãƒ†ãƒ¬ãƒ¡ãƒˆãƒªç„¡åŠ¹åŒ– |

### ãƒãƒ¼ãƒˆè¨­å®š

| ã‚µãƒ¼ãƒ“ã‚¹ | ãƒãƒ¼ãƒˆ | èª¬æ˜ |
|----------|--------|------|
| Nginx | 80, 443 | HTTPSãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚· |
| Streamlit | 8501 | ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰WebUI |
| FastAPI | 8000 | ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰API |
| Ollama | 11434 | LLMã‚µãƒ¼ãƒãƒ¼ |

## ğŸ“ ç®¡ç†ã‚³ãƒãƒ³ãƒ‰

### ãƒ­ã‚°ç¢ºèª
```bash
# å…¨ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ­ã‚°
docker-compose -f docker-compose.prod.yml logs -f

# ç‰¹å®šã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ­ã‚°
docker-compose -f docker-compose.prod.yml logs -f backend
docker-compose -f docker-compose.prod.yml logs -f frontend
```

### åœæ­¢ãƒ»å†èµ·å‹•
```bash
# åœæ­¢
docker-compose -f docker-compose.prod.yml down

# å†èµ·å‹•
docker-compose -f docker-compose.prod.yml restart

# å¼·åˆ¶å†ãƒ“ãƒ«ãƒ‰
docker-compose -f docker-compose.prod.yml build --no-cache
```

### ãƒ‡ãƒ¼ã‚¿ç®¡ç†
```bash
# ãƒ‡ãƒ¼ã‚¿ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
docker run --rm -v kitakyushu-waste-chatbot-enhanced_ollama_data:/data -v $(pwd):/backup ubuntu tar czf /backup/ollama_backup.tar.gz -C /data .

# ãƒ‡ãƒ¼ã‚¿ãƒªã‚¹ãƒˆã‚¢
docker run --rm -v kitakyushu-waste-chatbot-enhanced_ollama_data:/data -v $(pwd):/backup ubuntu tar xzf /backup/ollama_backup.tar.gz -C /data
```

## ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### æœ¬ç•ªç’°å¢ƒã§ã®æ³¨æ„äº‹é …

1. **SSLè¨¼æ˜æ›¸**: è‡ªå·±ç½²åè¨¼æ˜æ›¸ã®ä»£ã‚ã‚Šã«Let's Encryptãªã©ã‚’ä½¿ç”¨
2. **ç’°å¢ƒå¤‰æ•°**: `.env`ãƒ•ã‚¡ã‚¤ãƒ«ã§æ©Ÿå¯†æƒ…å ±ã‚’ç®¡ç†
3. **ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«**: å¿…è¦ãªãƒãƒ¼ãƒˆã®ã¿é–‹æ”¾
4. **ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ**: å®šæœŸçš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ

### æ¨å¥¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š

```bash
# Let's Encryptè¨¼æ˜æ›¸å–å¾—ä¾‹
certbot --nginx -d yourdomain.com

# ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«è¨­å®šä¾‹ï¼ˆUbuntuï¼‰
ufw allow 80
ufw allow 443
ufw enable
```

## ğŸ› ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

1. **GPUèªè­˜ã—ãªã„**
   ```bash
   # NVIDIA Container Toolkitç¢ºèª
   docker run --rm --gpus all nvidia/cuda:11.0-base nvidia-smi
   ```

2. **ãƒ¡ãƒ¢ãƒªä¸è¶³**
   ```bash
   # Dockerè¨­å®šã§ãƒ¡ãƒ¢ãƒªä¸Šé™ã‚’å¢—åŠ 
   # ã¾ãŸã¯è»½é‡ãƒ¢ãƒ‡ãƒ«ã«å¤‰æ›´
   ```

3. **ãƒãƒ¼ãƒˆç«¶åˆ**
   ```bash
   # ä½¿ç”¨ä¸­ãƒãƒ¼ãƒˆç¢ºèª
   sudo netstat -tulpn | grep :8000
   ```

## ğŸ“ ã‚µãƒãƒ¼ãƒˆ

å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã¯ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

1. [Issues](https://github.com/Hisayuki04072/kitakyushu-waste-chatbot-enhanced/issues)
2. `docker-compose logs`ã§ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’ç¢ºèª
3. ã‚·ã‚¹ãƒ†ãƒ è¦ä»¶ã‚’æº€ãŸã—ã¦ã„ã‚‹ã‹ç¢ºèª

## ğŸ“„ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯MITãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®ä¸‹ã§å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚
